<link rel="stylesheet" href="/css/room.css" />
<div class="container">
  <div class="wrapper-content-page">
    <div class="my-2">
      <label class="fw-bold form-label">รหัสห้องพัก</label>
      <input type="text" class="form-control" disabled value="<%= entries[0].room_id %>" id="room-id">
    </div>

    <%- include('room_edit_form/room_edit_roomnumber_form')  %>

    <div>
      <p class="my-1 fw-bold">
        * หากไม่ทราบว่าห้องพักของท่านตรงกับตัวเลือกไหน โปรดคลิกเพื่อดูรายละเอียด
      </p>
      <p class="my-1 fw-bold">
        * หากห้องพักของท่านไม่ตรงกับตัวเลือกเหล่านี้โปรดเลือกไม่ระบุ
      </p>
    </div>

    <%- include('room_edit_form/room_edit_typeroom_form')  %>
    <%- include('./roomtype-modal-info') %>

    <%- include('room_edit_form/room_edit_bedtype_form')  %>
    <%- include('./bedtype-modal-info') %>


    <%- include('room_edit_form/room_edit_roomview_form')  %>
    <%- include('./roomview-modal-info') %>


    <%- include('room_edit_form/room_edit_specialoptions_form')  %>

    <div class="row">
      <div class="col-xxl-6 col-xl-6 col-lg-6 col-md-8 col-sm-12 col-xs-12">
        <div class="my-2">
          <label class="form-label">จำนวนคนเข้าพักสูงสุด</label>
          <input type="number" value="<%= entries[0].max_people  %>" id="maxPeople" class="form-control" placeholder="ป้อนจำนวน">
          <p class="empty-validate" id="validate-maxpeople"></p>
        </div>
      </div>
      <div class="col-xxl-6 col-xl-6 col-lg-6 col-md-8 col-sm-12 col-xs-12">
        <div class="my-2">
          <label class="form-label">จำนวนห้องน้ำ</label>
          <input type="number" value="<%= entries[0].toilet_count  %>" id="toiletCount" class="form-control" placeholder="ป้อนจำนวน">
          <p class="empty-validate" id="validate-toilet-count"></p>
        </div>
      </div>
      <div class="col-xxl-6 col-xl-6 col-lg-6 col-md-8 col-sm-12 col-xs-12">
        <div class="my-2">
          <label class="form-label">ค่าของเสียหาย</label>
          <input type="number" value="<%= entries[0].damage  %>" id="damage" class="form-control" placeholder="ป้อนราคา">
          <p class="empty-validate" id="validate-damage"></p>
        </div>
      </div>
      <div class="col-xxl-6 col-xl-6 col-lg-6 col-md-8 col-sm-12 col-xs-12">
        <div class="my-2">
          <label class="form-label">เพิ่มราคาจำนวนคนเกิน</label>
          <input type="number" value="<%= entries[0].price_over_people  %>" id="priceOverPeople" class="form-control" placeholder="ป้อนราคาต่อคน">
          <p class="empty-validate" id="validate-over-people"></p>
        </div>
      </div>
    </div>
    <div>
      <h6 class="form-label">เพิ่มราคาเวลาพักเกิน</h6>
      <div class="row">
        <div class="col-xxl-4 col-xl-4 col-lg-4 col-md-6 col-sm-12 col-xs-12">
          <div class="my-2">
            <input type="number" value="<%= entries[0].price_over_minutes  %>" min="0" max="59" id="priceOverMinutes" class="form-control" placeholder="ต่อนาที">
            <p class="empty-validate" id="validate-over-minutes"></p>
          </div>
        </div>
        <div class="col-xxl-4 col-xl-4 col-lg-4 col-md-6 col-sm-12 col-xs-12">
          <div class="my-2">
            <input type="number" value="<%= entries[0].price_over_hour  %>" min="0" max="23" id="priceOverHour" class="form-control" placeholder="ต่อชั่วโมง">
            <p class="empty-validate" id="validate-over-hour"></p>
          </div>
        </div>
        <div class="col-xxl-4 col-xl-4 col-lg-4 col-md-6 col-sm-12 col-xs-12">
          <div class="my-2">
            <input type="number" value="<%= entries[0].price_over_day  %>" min="0" id="priceOverDay" class="form-control" placeholder="ต่อวัน">
            <p class="empty-validate" id="validate-over-day"></p>
          </div>
        </div>
        <div class="col-xxl-4 col-xl-4 col-lg-4 col-md-6 col-sm-12 col-xs-12">
          <div class="my-2">
            <input type="number" value="<%= entries[0].price_over_week  %>" min="0" id="priceOverWeek" class="form-control" placeholder="ต่อสัปดาห์">
            <p class="empty-validate" id="validate-over-week"></p>
          </div>
        </div>
        <div class="col-xxl-4 col-xl-4 col-lg-4 col-md-6 col-sm-12 col-xs-12">
          <div class="my-2">
            <input type="number" value="<%= entries[0].price_over_month  %>" min="0" id="priceOverMonth" class="form-control" placeholder="ต่อเดือน">
            <p class="empty-validate" id="validate-over-month"></p>
          </div>
        </div>
        <div class="col-xxl-4 col-xl-4 col-lg-4 col-md-6 col-sm-12 col-xs-12">
          <div class="my-2">
            <input type="number" value="<%= entries[0].price_over_year  %>" min="0" id="priceOverYear" class="form-control" placeholder="ต่อปี">
            <p class="empty-validate" id="validate-over-year"></p>
          </div>
        </div>
      </div>
    </div>
    <div class="my-3">
      <h6 class="fw-bold form-label">
        คำอธิบาย - รายละเอียด
      </h6>
      <textarea class="form-control" id="desc-room" rows="12"><%= entries[0].detail  %></textarea>
      <p class="empty-validate" id="validate-descript"></p>
    </div>



    <input type="hidden" id="example-old-delete">
    <input type="hidden" value="<%= entries[0].example_room  %>" id="example-old-value">
    <div class="my-3">
      <h6 class="fw-bold form-label">
        <i class="fa-solid fa-panorama"></i>
        รูปภาพตัวอย่างเดิม
      </h6>
      <div id="example-old-preview" class="example-preview">
        <% example_room=entries[0].example_room.split(',') %>
        <% for(let i=0;i< example_room.length;i++){ %>
        <div class="example-editing">
          <img src="/src/img/example_room/<%=  example_room[i] %>" class="example-imgview"></img>
          <button class="ac-btn img-acout border-radius-12" data-acout="<%= example_room[i] %>">
            <i class="fa-solid fa-xmark"></i>
          </button>
        </div>
        <% } %>
      </div>
    </div>

    <div class="my-3">
      <label for="room-upload" class="ac-btn label-upload bg-violet">
        <i class="fa-solid fa-paperclip"></i>
        อัพโหลดรูปภาพ
        <input type="file" class="input-file" id="room-upload" multiple accept="image/*" />
      </label>

      <h6 class="fw-bold form-label">
        <i class="fa-solid fa-photo-film"></i>
        รูปภาพที่ต้องการอัพโหลด
      </h6>
      <div id="example-group-preview" class="example-preview"></div>
      <p class="empty-validate" id="validate-roomupload"></p>
    </div>

    <button type="button" class="ac-btn bg-blue border-radius-12" id="room-update" data-id="<%= entries[0].room_id  %>">
      อัพเดต
      <i class="fa-regular fa-pen-to-square"></i>
    </button>
  </div>
  <script src="/js/admin/RoomUpdate.js"></script>
  <script>
    window.addEventListener('load', () => {
      activeroomType()
      activebedType()
      activeroomView()
      activeSpecialOption()
    })


    $('.img-acout').click(function() {
      $(this).parent().remove()
      const v = $(this).attr('data-acout')
      const exampleOldValue = $('#example-old-value')
      const exampleOldDelete = $('#example-old-delete')
      const exampleOld = exampleOldValue.val().split(',')
      const exampleOfterDelete = exampleOld.filter((e) => e != v)
      let exampleDelete = exampleOldDelete.val().split(',')

      if (exampleOldDelete.val() == '') {
        exampleDelete = []
      } else if (exampleOldDelete.val() != '') {
        exampleDelete = exampleOldDelete.val().split(',')
      }

      exampleDelete.push(v)
      exampleOldDelete.val(exampleDelete.join(','))

      if (exampleOfterDelete.length == 0) {
        exampleOldValue.val('')
      } else if (exampleOfterDelete.length > 0) {
        exampleOldValue.val(exampleOfterDelete.join(','))
      }

    })


    $('[name="special-options"]').change(function() {
      const specialOptions = $('[name="special-options"]')
      const opt = $(this).val().trim();

      if (opt == "non-special-options") {
        for (let i = 0; i < specialOptions.length; i++) {
          const checkItem = $(specialOptions[i]);
          if (checkItem.val().trim() != "non-special-options") {
            $(checkItem).prop("checked", false);
          }
        }
      } else {
        const index = $.map(specialOptions, (e) => $(e).val()).indexOf("non-special-options");
        specialOptions.filter(`:eq(${index})`).prop('checked', false)
      }
    });

    $('#room-upload').change(function(e) {
      const file = e.target.files;
      let imgItem = ``;
      for (let i = 0; i < file.length; i++) {
        const src = URL.createObjectURL(file[i]);
        const img = `<img src="${src}" class="example-imgview ">`;
        imgItem += img;
      }
      $("#example-group-preview").html(imgItem);
    });


    function activeroomType() {
      const roomType = $('[name="room-type"]')
      const rt = $('#roomtype-value').val()
      const mapRoomtype = $.map(roomType, (e, i) => $(e).val())
      const includeItem = mapRoomtype.includes(rt)
      if (includeItem == true) {
        for (let i = 0; i < roomType.length; i++) {
          const item = $(roomType[i])
          const v = item.val()
          if (rt == v) {
            item.prop('checked', true)
          }
        }
      }
    }


    function activebedType() {
      const bedType = $('[name="bed-type"]')
      const bed = $('#bedtype-value').val()
      const mapBedtype = $.map(bedType, (e, i) => $(e).val())
      const includeItem = mapBedtype.includes(bed)
      if (includeItem == true) {
        for (let i = 0; i < bedType.length; i++) {
          const item = $(bedType[i])
          const v = item.val()
          if (bed == v) {
            item.prop('checked', true)
          }
        }
      }
    }

    function activeroomView() {
      const roomView = $('[name="roomview"]')
      const view = $('#roomview-value').val()
      const mapView = $.map(roomView, (e, i) => $(e).val())
      const includeItem = mapView.includes(view)
      if (includeItem == true) {
        for (let i = 0; i < roomView.length; i++) {
          const item = $(roomView[i])
          const v = item.val()
          if (view == v) {
            item.prop('checked', true)
          }
        }
      }
    }

    function activeSpecialOption() {
      const opt = $('#specialoptions-value').val().split(',')
      const isNon = opt.includes('non-special-options')

      if (!isNon) {
        $.each($('[name="special-options"]'), (index, el) => {
          if ($(el).val() == 'have-special-options') {
            $(el).prop('checked', true)
          }
        })
      }

      const mapOpt = $.map($('[name="special-options"]'), (element, index) => $(element).val())
      let speciaOptionsEl = ''
      opt.forEach(v => {
        const index = mapOpt.indexOf(v)
        if (index < 0) {
          speciaOptionsEl += ` 
              <div class="row">
                <div class="col-xxl-6 col-xl-6 col-lg-6 col-md-12 col-sm-12 col-xs-12">
                    <div class="input-group my-1">
                      <input type="text" class="form-control" value="${v}" name="special-options-text" placeholder="ป้อนข้อมูลเพิ่ม">
                      <button class="ac-btn text-darkgray bg-none" onclick="deleteSpecialText(event)">
                        <i class="fa-solid fa-trash-can"></i>
                      </button>
                    </div>
                  </div>
                </div>
              `
        }
        if (index >= 0) {
          $.each($('[name="special-options"]'), (index, element) => {
            if ($(element).val() == v) {
              $(element).prop('checked', true)
            }
          })
        }
      })
      $('#n-special-options').html(speciaOptionsEl)
    }
  </script>